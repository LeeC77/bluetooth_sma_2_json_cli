# SMA Inverter (Bluetooth) to stdout json

> If you use this project please consider donating to my favorite charity: <https://www.nowdonate.com/checkout/pv0j03m4s1o1x60o6bh2>

This CLI utility collects data from an [SMA](https://www.sma.de/en/) Solar Inverter using BlueTooth and returns as json to stdout. Its intended  use is to  allow integration with smart home projects like [openHAB](https://www.openhab.org/). If your inverter connects to [SMA Sunny Explorer then](https://www.sma.de/en/products/energy-management/sunny-explorer) it should work with this utility
This utility is controlled by command line switches.
The output is to stdout and is in the form:
```json
{"code" : 0, "message" : "Success", "data" :{"daily" : 1888, "total" : 42555658, "watts" : 165, "temperature" : 27.62, "acvolts" : 241.02,"time" : "Fri, 31 Oct 2025 16:10:53 GMT Standard Time"}}
```
where
- ```daily```  is the SMA daily total energy. Unit: Wh
- ```total``` is the gross total energy for the inverter. Unit: Wh
- ```watts``` is the spot power measurement. Unit: W
- ```acvolts``` is the spot voltage measurement. Unit: V
- ```temperature``` is the internal temperature of the inverter. Unit: °C
- ``time`` is the inverter time of reading
- ```code``` and ```message``` are  used to indicate states generated by the utility itself code: 0 is successful.

The Json output can be read from stdout and deserialized by another program.
The Bluetooth connection credentials are passed on the commend line via switches. Optionally for improved security the password can be psupplied via stdin.

If you wish to use this with [openHAB](https://www.openhab.org/) there is a binding in development (Nov 2025) please check in on the [openHAB Community Forum](https://community.openhab.org/)

I have a SMA Sunny Boy 3600TL Inverter and my openHAB installed on an RasPi 4 using openhabian. My inverter has been updated to FW3.25.05_SB3600TL-20 but there is no reason to suspect that this will not work with other SMA invertors or FWs. [SMA Downloads](https://www.sma.de/en/service/downloads)

## Overview

The motivation for this project was to have a light weight solution that **did not require the installation of MQTT or SQL** like other solutions and can run silently on the same server, RasPi, as my openHAB.

The project calls extensively on work done by others:

- [SBFspot](https://github.com/SBFspot/SBFspot/tree/master/SBFspot)
- [James Ball](http://blog.jamesball.co.uk/2013/02/understanding-sma-bluetooth-protocol-in.html?q=SMA)
- [David Gibson](https://github.com/dgibson/python-smadata2)

There has been previous discussion in the openHAB Community Forum on this subject and this may be of interest to some  
<https://community.openhab.org/t/example-on-how-to-access-data-of-a-sunny-boy-sma-solar-inverter/50963>



### Some Cautions / Trouble Shooting 
* Passwords and API keys are used as plain text, you need to be comfortable with your own security arrangements and understand your specific risks.
* If the bluetooth from your inverter is disabled you will need to set the NetID to 1 (default). The Bluetooth NetID is a physical setting that must be changed using a rotary switch inside the inverter's enclosure. See the [Installation Manual](https://www.inbalance-energy.co.uk/datasheets_downloads/SunnyBoy/sb3600tl_installation_manual.pdf)
* I used a RasPi 4 that has a built in Bluetooth, not all RasPis / PCs have Bluetooth and may require a dongle, this has not  been tested.
* If you see __Debian RFCOMM Bluetooth fix Protocol not supported__, you may need to use the workaround for Bluez PNAT on RasPi see here:  
https://forums.raspberrypi.com//viewtopic.php?p=521067#p521067
___

> Debian RFCOMM Bluetooth fix Protocol not supported.   
> 
https://github.com/mathoudebine/homeassistant-timebox-mini/issues/5   
https://support.plugable.com/t/bluetooth-home-automation-switch-btaps1-raspberry-pi-error/8554   
https://forums.raspberrypi.com//viewtopic.php?p=521067#p521067

```
    sudo apt-get update
    sudo apt-get install bluez minicom bluez-utils
```
If bluez-utils doesn’t exist then make sure bluez and minicom are installed.  
Bluez PNAT is not needed and breaks things, so edit main.conf:
```
sudo nano /etc/bluetooth/main.conf
```
In "general" add the following:   
DisablePlugins = pnat   
Reboot your RasPi  
_____________

### Deployment / Installation

You have ywo choices:
- Copy the the executable for either Windows or Debian from this repository

  For Linux ```wget https://raw.githubusercontent.com/LeeC77/bluetooth_sma_2_json_cli/master/Executable/Debian/sma2json.exe``` 

  For Windows ```curl "curl.exe "https://raw.githubusercontent.com/LeeC77/bluetooth_sma_2_json_cli/master/Executable/Windows/sma2json.exe" -L -o sma2json.exe``` 

- Build from for Python source cade files (if your OS is not supported). Yoy will Git  installed 
[Git for Windows website:](https://git-scm.com/download/win) or for Linux use your distribution's package manager to install Git.

```git clone https://github.com/LeeC77/bluetooth_sma_2_json_cli.git``` 

  If you want to use this with the openHAB binding then create a new directory called 'files' at $OPENHAB_HOME\userdata and copy sma2json.exe file across.

#### Python Build and Virtual Environment

As python is used in the base builds for modern operating systems, installing modules directly can cause issues. To avoid this create a virtual environment as part of your development environment.

- Ensure compatible Python version: Make sure the target machine has a compatible Python interpreter installed (e.g., Python 3.14.0).
- Open a command terminal in your working directory.
- Clone this project, see above
- Change your working directory ```cd bluetooth_sma_2_json_cli```
- Create a new venv ```python -m venv venv```
- Activate the venv ```source venv/bin/activate```
- Install dependencies from the file: Install all required packages using the requirements.txt file you transferred with the source code. ```pip install -r requirements.txt```
- Build the executable windows: ```pyinstaller .\main.py --onefile -n.\sma2json.exe``` Linux ``` pyinstaller ./main.py --onefile -n./sma2json.exe```
- This will produce a standalone executable (or a folder containing necessary files) in a dist/ directory, which is specific to the OS
- Deactivate the venv if you wish with ```deactivate```
- You can if you wish remove the cloned directory after you have tested the executable.

**Don't forget to make 'sma2json.exe' executable and set the ownership, if your OS requires it. ```chmod +x sma2json.exe```**

#### Test you install

To test your install 
```bash
   ./sma2json -b<00:00:00:00:00:00> -p<pass_word>
```
* replace <00:00:00:00:00:00> with the inverter bluetooth inverter address, you may need to use a bluetooth snooping tool to find this.

* replace <pass_word> with the SMA Sunny Explorer password.

Run the Python script (or executable if build / copied) with the -h switch to get help. e.g.
```
>> ./sma2json.exe -h
usage: sma2json.exe [-h] [-b BTADDR] [-p PASSWORD] [-r] [-t] [-v] [-s]

SMA Bluetooth JSON. Version: 1.0.0 Date: 30 Oct 2025

options:
  -h, --help            show this help message and exit
  -b, --btaddr BTADDR   the bluetooth address of the inverter e.g. 00:80:25:XX:XX:XX (default: None)
  -p, --password PASSWORD
                        password for the inverter (default: None)
  -r, --readable        off (default) output results in json format, on output in human readable format (default:
                        False)
  -t, --test            test mode - use hardcoded values rather than connecting to inverter (default: False)
  -v, --version         report version only, main() doesn't run (default: False)
  -s, --stdin           read password from stdin for better security overrides -p (default: False)

```

Thats it, hope it  works for you.